<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UR CST Internship Portal - Complete System</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#4f46e5;
      --muted:#94a3b8;
      --glass:rgba(255,255,255,0.04);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0033cc, #007bff, #00bfff);
      background-size: 400% 400%;
      animation: moveGradient 12s ease infinite;
      padding: 20px;
      position: relative;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.2);
      opacity: 0.8;
      z-index: 1;
    }

    @keyframes moveGradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      position: relative;
      z-index: 2;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: 20px;
      padding: 40px;
      max-width: 1400px;
      width: 100%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      margin: 20px auto;
    }

    h1 { 
      font-size: 2.8rem;
      font-weight: 700;
      color: white;
      margin-bottom: 10px;
      text-shadow: 0 0 30px rgba(0, 180, 255, 0.8), 0 2px 4px rgba(0, 0, 0, 0.3);
      text-align: center;
    }

    .subtitle { 
      color: #e0f0ff;
      margin-bottom: 35px;
      font-size: 1.1rem;
      font-weight: 400;
      text-align: center;
    }

    .btn-3d {
      background: linear-gradient(145deg, #0099ff, #0066cc);
      border: none;
      color: white;
      padding: 14px 30px;
      border-radius: 12px;
      margin: 10px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.1s ease;
      box-shadow: 0 6px 0 #004a99, 0 8px 12px rgba(0, 0, 0, 0.3);
      position: relative;
      top: 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-3d:hover {
      background: linear-gradient(145deg, #00aaff, #0077dd);
      box-shadow: 0 6px 0 #004a99, 0 10px 15px rgba(0, 0, 0, 0.4);
    }

    .btn-3d:active {
      top: 4px;
      box-shadow: 0 2px 0 #004a99, 0 4px 8px rgba(0, 0, 0, 0.3);
      transform: scale(0.98);
    }

    .btn-3d-secondary {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
      box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2), 0 6px 10px rgba(0, 0, 0, 0.2);
      padding: 10px 20px;
      font-size: 0.9rem;
    }

    .btn-3d-secondary:hover {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25));
    }

    .btn-3d-success {
      background: linear-gradient(145deg, #00cc66, #009944);
      box-shadow: 0 5px 0 #006633, 0 7px 10px rgba(0, 0, 0, 0.3);
      padding: 12px 24px;
    }

    .btn-3d-danger {
      background: linear-gradient(145deg, #ff4444, #cc0000);
      box-shadow: 0 5px 0 #990000, 0 7px 10px rgba(0, 0, 0, 0.3);
      padding: 10px 20px;
      font-size: 0.9rem;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
      margin: 2px;
    }

    .role-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 30px;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .section {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      margin-bottom: 20px;
    }

    .section h2 {
      color: white;
      margin-bottom: 20px;
      font-size: 1.8rem;
      text-shadow: 0 0 15px rgba(0, 180, 255, 0.6);
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin: 28px 0 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      color: white;
      text-shadow: 0 0 10px rgba(0, 180, 255, 0.4);
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      margin-bottom: 15px;
      background: rgba(255, 255, 255, 0.9);
      font-size: 1rem;
      font-family: 'Poppins', sans-serif;
      color: #333;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #00aaff;
      box-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
    }

    select option {
      color: #000;
      font-weight: 600;
      background: #fff;
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    .user-header {
      background: rgba(255, 255, 255, 0.15);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-info {
      color: white;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .auth-toggle {
      text-align: center;
      margin-top: 15px;
      color: #e0f0ff;
    }

    .auth-toggle a {
      color: #4dd0ff;
      cursor: pointer;
      text-decoration: underline;
    }

    label {
      display: block;
      font-size: 13px;
      color: #e0f0ff;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
    }

    .form-grid .full {
      grid-column: 1/3;
    }

    .file-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 14px;
    }

    .filebox {
      padding: 16px;
      border-radius: 12px;
      border: 2px dashed rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.05);
      text-align: center;
      transition: all 0.3s;
    }

    .filebox:hover {
      border-color: rgba(79, 70, 229, 0.6);
      background: rgba(79, 70, 229, 0.1);
    }

    .filebox-title {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 10px;
      color: #e6eef8;
    }

    .filebox input[type=file] {
      margin: 8px 0;
      font-size: 12px;
      background: transparent;
      color: white;
    }

    .hint {
      font-size: 11px;
      color: var(--muted);
      margin-top: 6px;
      line-height: 1.4;
    }

    .preview {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      margin-top: 12px;
    }

    .thumb {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: none;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 2px solid rgba(255, 255, 255, 0.2);
    }

    .progress-text {
      font-size: 14px;
      color: #e0f0ff;
      font-weight: 500;
    }

    .progress-text strong {
      color: #06b6d4;
      font-size: 18px;
    }

    .btn-group {
      display: flex;
      gap: 12px;
    }

    .tabs {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .tab {
      padding: 12px 24px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #e0f0ff;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      font-size: 14px;
    }

    .tab:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(79, 70, 229, 0.3);
    }

    .tab.active {
      background: linear-gradient(90deg, #4f46e5, #06b6d4);
      color: white;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      padding: 24px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s;
    }

    .stat-card:hover {
      border-color: rgba(79, 70, 229, 0.3);
      transform: translateY(-2px);
    }

    .stat-label {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      background: linear-gradient(90deg, #06b6d4, #4f46e5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .capacity-grid {
      display: grid;
      gap: 16px;
    }

    .capacity-item {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 150px;
      gap: 16px;
      align-items: center;
      padding: 20px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      transition: all 0.3s;
    }

    .capacity-item:hover {
      border-color: rgba(79, 70, 229, 0.3);
      background: rgba(255, 255, 255, 0.12);
    }

    .dept-name {
      font-weight: 600;
      color: #e6eef8;
    }

    .stat-mini {
      text-align: center;
    }

    .stat-mini-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .stat-mini-value {
      font-size: 18px;
      font-weight: 700;
      color: #06b6d4;
    }

    .stat-mini-value.remaining {
      color: #10b981;
    }

    .stat-mini-value.full {
      color: #ff6b6b;
    }

    .filters {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 300px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      overflow: hidden;
    }

    thead {
      background: rgba(255, 255, 255, 0.1);
    }

    th {
      padding: 16px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
      color: #e0f0ff;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    td {
      padding: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 14px;
      color: #e0f0ff;
    }

    tbody tr {
      transition: all 0.2s;
    }

    tbody tr:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-success {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
    }

    .badge-warning {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }

    .badge-danger {
      background: rgba(255, 107, 107, 0.2);
      color: #ff6b6b;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    footer { 
      margin-top: 30px;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
      text-align: center;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }

    @media (max-width: 768px) {
      .container { padding: 25px; }
      h1 { font-size: 2rem; }
      .btn-3d { padding: 12px 20px; font-size: 0.9rem; }
      .form-grid { grid-template-columns: 1fr; }
      .form-grid .full { grid-column: 1/2; }
      .actions { flex-direction: column; gap: 15px; }
      .capacity-item { grid-template-columns: 1fr; gap: 12px; }
      .stat-mini { text-align: left; }
      .filters { flex-direction: column; }
      select, .search-box { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Landing Page -->
    <div id="landingPage" class="page active">
      <h1>üéì UR CST Internship Portal</h1>
      <p class="subtitle">Welcome! Please select your role below üëá</p>
      <div class="role-buttons">
        <button class="btn-3d" onclick="showPage('applicantAuth')">üéì Applicant</button>
        <button class="btn-3d" onclick="showPage('companyAuth')">üè¢ Company</button>
        <button class="btn-3d" onclick="checkAdminPassword()">üîí Admin Portal</button>
      </div>
    </div>

    <!-- Applicant Auth -->
    <div id="applicantAuth" class="page">
      <div class="section">
        <h2 id="applicantAuthTitle">Applicant Login</h2>
        <form id="applicantAuthForm" onsubmit="handleApplicantAuth(event)">
          <label>Full Name</label>
          <input type="text" id="applicantName" required>
          
          <label>Email</label>
          <input type="email" id="applicantEmail" required>
          
          <label>Password</label>
          <input type="password" id="applicantPassword" required>
          
          <div id="applicantFieldContainer" style="display:none;">
            <label>Field of Study</label>
            <input type="text" id="applicantField">
          </div>
          
          <button type="submit" class="btn-3d btn-3d-success">Login</button>
          <button type="button" class="btn-3d btn-3d-secondary" onclick="showPage('landingPage')">Back</button>
        </form>
        <div class="auth-toggle">
          <span id="applicantToggleText">Don't have an account? <a onclick="toggleApplicantMode()">Sign Up</a></span>
        </div>
      </div>
    </div>

    <!-- Company Auth -->
    <div id="companyAuth" class="page">
      <div class="section">
        <h2 id="companyAuthTitle">Company Login</h2>
        <form id="companyAuthForm" onsubmit="handleCompanyAuth(event)">
          <label>Company Name</label>
          <input type="text" id="companyName" required>
          
          <label>Email</label>
          <input type="email" id="companyEmail" required>
          
          <label>Password</label>
          <input type="password" id="companyPassword" required>
          
          <button type="submit" class="btn-3d btn-3d-success">Login</button>
          <button type="button" class="btn-3d btn-3d-secondary" onclick="showPage('landingPage')">Back</button>
        </form>
        <div class="auth-toggle">
          <span id="companyToggleText">Don't have an account? <a onclick="toggleCompanyMode()">Sign Up</a></span>
        </div>
      </div>
    </div>

    <!-- Applicant Application Form -->
    <div id="applicantDashboard" class="page">
      <div class="user-header">
        <div class="user-info">üë§ <span id="applicantNameDisplay"></span></div>
        <button class="btn-3d btn-3d-danger" onclick="logout()">Logout</button>
      </div>

      <div class="section">
        <h2>üá∑üáº Rwanda Internship Application</h2>
        <p style="color: #e0f0ff; margin-bottom: 20px;">Apply for internships at leading companies across Rwanda</p>

        <form id="internForm" onsubmit="handleInternshipSubmit(event)">
          <!-- Company Selection -->
          <div class="section-title">1. Company Selection / Hitamo Kampani</div>
          
          <div class="form-grid">
            <div>
              <label for="companyType">Company Type *</label>
              <select id="companyType" onchange="filterCompanies()" required>
                <option value="">Select Type...</option>
                <option value="all">All Companies</option>
                <option value="public">Public Sector</option>
                <option value="private">Private Sector</option>
              </select>
            </div>

            <div>
              <label for="industry">Industry *</label>
              <select id="industry" onchange="filterCompanies()" required>
                <option value="">Select Industry...</option>
                <option value="all">All Industries</option>
                <option value="technology">Technology & IT</option>
                <option value="finance">Finance & Banking</option>
                <option value="telecommunications">Telecommunications</option>
                <option value="government">Government</option>
                <option value="healthcare">Healthcare</option>
                <option value="education">Education</option>
                <option value="manufacturing">Manufacturing</option>
                <option value="agriculture">Agriculture</option>
                <option value="tourism">Tourism</option>
                <option value="energy">Energy</option>
              </select>
            </div>

            <div class="full">
              <label for="company">Select Company *</label>
              <select id="company" required>
                <option value="">First select company type and industry...</option>
              </select>
            </div>

            <div>
              <label for="department">Department *</label>
              <select id="department" required>
                <option value="">Select Department...</option>
                <option value="Computer Science">Computer Science</option>
                <option value="Software Engineering">Software Engineering</option>
                <option value="Information Technology">Information Technology</option>
                <option value="Data Science">Data Science</option>
                <option value="Cybersecurity">Cybersecurity</option>
                <option value="Applied Mathematics">Applied Mathematics</option>
                <option value="Physics">Physics</option>
                <option value="Chemistry">Chemistry</option>
                <option value="Biology">Biology</option>
                <option value="Environmental Science">Environmental Science</option>
                <option value="Biotechnology">Biotechnology</option>
                <option value="Engineering">Engineering</option>
              </select>
            </div>

            <div>
              <label for="duration">Internship Duration *</label>
              <select id="duration" required>
                <option value="">Select Duration...</option>
                <option value="1">1 Month</option>
                <option value="2">2 Months</option>
                <option value="3">3 Months</option>
                <option value="4">4 Months</option>
                <option value="6">6 Months</option>
                <option value="12">1 Year</option>
              </select>
            </div>

            <div>
              <label for="startDate">Preferred Start Date *</label>
              <input id="startDate" type="date" required>
            </div>

            <div>
              <label for="referenceNumber">Reference Number (if any)</label>
              <input id="referenceNumber" type="text" placeholder="e.g., INT-2025-001">
            </div>
          </div>

          <!-- Personal Information -->
          <div class="section-title">2. Personal Information</div>
          
          <div class="form-grid">
            <div class="full">
              <label for="fullname">Full Name *</label>
              <input id="fullname" type="text" placeholder="e.g., Jean Claude Uwimana" required>
            </div>

            <div>
              <label for="gender">Gender *</label>
              <select id="gender" required>
                <option value="">Select...</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div>
              <label for="dob">Date of Birth *</label>
              <input id="dob" type="date" required>
            </div>

            <div>
              <label for="email">Email Address *</label>
              <input id="email" type="email" placeholder="example@email.com" required>
            </div>

            <div>
              <label for="phone">Phone Number *</label>
              <input id="phone" type="tel" placeholder="+250 7XX XXX XXX" required>
            </div>

            <div>
              <label for="nationalId">National ID Number *</label>
              <input id="nationalId" type="text" placeholder="1 XXXX X XXXXXXX X XX" required>
            </div>
          </div>

          <!-- Education Information -->
          <div class="section-title">3. Education Information</div>
          
          <div class="form-grid">
            <div>
              <label for="institution">Institution *</label>
              <input id="institution" type="text" placeholder="e.g., University of Rwanda" required>
            </div>

            <div>
              <label for="studyLevel">Level of Study *</label>
              <select id="studyLevel" required>
                <option value="">Select Level...</option>
                <option value="diploma">Diploma</option>
                <option value="bachelors">Bachelor's Degree</option>
                <option value="masters">Master's Degree</option>
                <option value="phd">PhD</option>
              </select>
            </div>

            <div>
              <label for="fieldOfStudy">Field of Study *</label>
              <input id="fieldOfStudy" type="text" placeholder="e.g., Computer Science" required>
            </div>

            <div>
              <label for="yearOfStudy">Current Year of Study *</label>
              <select id="yearOfStudy" required>
                <option value="">Select Year...</option>
                <option value="1">Year 1</option>
                <option value="2">Year 2</option>
                <option value="3">Year 3</option>
                <option value="4">Year 4</option>
                <option value="5">Year 5</option>
                <option value="graduated">Graduated</option>
              </select>
            </div>

            <div>
              <label for="gpa">GPA / CGPA (Optional)</label>
              <input id="gpa" type="text" placeholder="e.g., 3.5">
            </div>

            <div>
              <label for="graduationDate">Expected Graduation Date *</label>
              <input id="graduationDate" type="date" required>
            </div>
          </div>

          <!-- Location Information -->
          <div class="section-title">4. Location Information</div>
          
          <div class="form-grid">
            <div>
              <label for="province">Province *</label>
              <select id="province" onchange="populateDistricts()" required>
                <option value="">Select Province...</option>
                <option value="Kigali">Kigali City</option>
                <option value="Northern">Northern Province</option>
                <option value="Southern">Southern Province</option>
                <option value="Eastern">Eastern Province</option>
                <option value="Western">Western Province</option>
              </select>
            </div>

            <div>
              <label for="district">District *</label>
              <select id="district" onchange="populateSectors()" required>
                <option value="">First select province...</option>
              </select>
            </div>

            <div>
              <label for="sector">Sector *</label>
              <select id="sector" required>
                <option value="">First select district...</option>
              </select>
            </div>

            <div>
              <label for="address">Street Address (Optional)</label>
              <input id="address" type="text" placeholder="e.g., KG 123 St">
            </div>
          </div>

          <!-- Document Uploads -->
          <div class="section-title">5. Document Uploads</div>
          
          <div class="full">
            <div class="file-group">
              <div class="filebox">
                <div class="filebox-title">National ID *</div>
                <input id="idfile" type="file" accept="image/*,.pdf" onchange="previewImage(event,'idPreview')" required>
                <div class="hint">Upload clear ID image or PDF</div>
                <div class="preview"><img id="idPreview" class="thumb" alt="ID preview"/></div>
              </div>

              <div class="filebox">
                <div class="filebox-title">Passport Photo *</div>
                <input id="photofile" type="file" accept="image/*" onchange="previewImage(event,'photoPreview')" required>
                <div class="hint">Recent passport photo</div>
                <div class="preview"><img id="photoPreview" class="thumb" alt="Photo preview"/></div>
              </div>

              <div class="filebox">
                <div class="filebox-title">CV / Resume *</div>
                <input id="cvfile" type="file" accept=".pdf,.doc,.docx" required>
                <div class="hint">PDF or DOCX format</div>
              </div>

              <div class="filebox">
                <div class="filebox-title">Academic Transcripts *</div>
                <input id="reportfile" type="file" accept=".pdf,.doc,.docx" required>
                <div class="hint">Latest academic records</div>
              </div>

              <div class="filebox">
                <div class="filebox-title">Cover Letter *</div>
                <input id="coverLetter" type="file" accept=".pdf,.doc,.docx" required>
                <div class="hint">Motivation letter</div>
              </div>

              <div class="filebox">
                <div class="filebox-title">Recommendation Letter</div>
                <input id="recommendation" type="file" accept=".pdf,.doc,.docx">
                <div class="hint">Optional but recommended</div>
              </div>
            </div>
          </div>

          <!-- Skills & Experience -->
          <div class="section-title">6. Skills & Experience</div>
          
          <div class="form-grid">
            <div class="full">
              <label for="skills">Key Skills (Optional)</label>
              <textarea id="skills" placeholder="List your relevant skills (e.g., Python, Excel, Project Management)..."></textarea>
            </div>

            <div class="full">
              <label for="experience">Previous Experience (Optional)</label>
              <textarea id="experience" placeholder="Describe any relevant work experience or projects..."></textarea>
            </div>

            <div class="full">
              <label for="motivation">Why this company? *</label>
              <textarea id="motivation" placeholder="Explain why you want to intern at this company..." required></textarea>
            </div>
          </div>

          <div class="actions">
            <div class="progress-text">
              Progress: <strong id="filledCount">0 / 25</strong> required fields
            </div>
            <div class="btn-group">
              <button type="reset" class="btn-3d btn-3d-secondary" onclick="resetApplicationForm()">Reset</button>
              <button type="submit" class="btn-3d btn-3d-success">Submit Application</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Company Dashboard -->
    <div id="companyDashboard" class="page">
      <div class="user-header">
        <div class="user-info">üè¢ <span id="companyNameDisplay"></span></div>
        <button class="btn-3d btn-3d-danger" onclick="logout()">Logout</button>
      </div>

      <div class="section">
        <h2>Add Internship Position</h2>
        <form id="companyForm" onsubmit="handleCompanyInternship(event)">
          <div class="form-grid">
            <div>
              <label for="compField">Field</label>
              <select id="compField" required>
                <option value="">Select Field</option>
                <option>Computer Science</option>
                <option>Software Engineering</option>
                <option>IT</option>
                <option>Data Science</option>
                <option>Accounting</option>
                <option>Marketing</option>
                <option>Civil Engineering</option>
              </select>
            </div>
            <div>
              <label for="compSlots">Available Slots</label>
              <input type="number" id="compSlots" placeholder="Available Slots" required min="1">
            </div>
          </div>
          <button type="submit" class="btn-3d btn-3d-success">Add Internship</button>
        </form>

        <h2 style="margin-top: 30px;">Your Posted Internships</h2>
        <div id="companyInternships"></div>
      </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="page">
      <div class="user-header">
        <div class="user-info">üîí Admin Panel</div>
        <button class="btn-3d btn-3d-danger" onclick="logout()">Logout</button>
      </div>

      <div class="tabs">
        <div class="tab active" onclick="switchAdminTab('overview')">Overview</div>
        <div class="tab" onclick="switchAdminTab('capacity')">Manage Capacity</div>
        <div class="tab" onclick="switchAdminTab('applicants')">View Applicants</div>
      </div>

      <!-- Overview Tab -->
      <div id="overview" class="tab-content active">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Total Applications</div>
            <div class="stat-value" id="totalApps">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Capacity</div>
            <div class="stat-value" id="totalCapacity">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Available Spaces</div>
            <div class="stat-value" id="availableSpaces">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Departments</div>
            <div class="stat-value">12</div>
          </div>
        </div>

        <div class="section">
          <h2>Department Status Overview</h2>
          <div id="overviewGrid"></div>
        </div>
      </div>

      <!-- Capacity Management Tab -->
      <div id="capacity" class="tab-content">
        <div class="section">
          <h2>Set Department Capacities</h2>
          <div class="capacity-grid" id="capacityGrid"></div>
        </div>
      </div>

      <!-- Applicants Tab -->
      <div id="applicants" class="tab-content">
        <div class="section">
          <h2>All Applicants</h2>
          
          <div class="filters">
            <select id="deptFilter" onchange="filterApplicants()">
              <option value="">All Departments</option>
            </select>
            
            <select id="statusFilter" onchange="filterApplicants()">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="approved">Approved</option>
              <option value="rejected">Rejected</option>
            </select>
            
            <div class="search-box">
              <input type="text" id="searchBox" placeholder="Search by name, email, or phone..." oninput="filterApplicants()">
            </div>
          </div>

          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Full Name</th>
                  <th>Department</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Location</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="applicantsTableBody">
                <tr>
                  <td colspan="8">
                    <div class="empty-state">
                      <div class="empty-state-icon">üìã</div>
                      <div>No applicants yet</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <footer>¬© 2025 UR CST Internship Portal üíô</footer>
  </div>

  <script>
    // Global state
    let applicantsDB = [];
    let companiesDB = [];
    let companyInternships = [];
    let submittedApplications = [];
    let currentUser = null;
    let currentUserType = null;
    let isApplicantSignup = false;
    let isCompanySignup = false;

    // Admin data
    const departments = [
      'Computer Science', 'Software Engineering', 'Information Technology',
      'Data Science', 'Cybersecurity', 'Applied Mathematics',
      'Physics', 'Chemistry', 'Biology',
      'Environmental Science', 'Biotechnology', 'Engineering'
    ];
    let departmentCapacities = {};
    let departmentApplications = {};

    // Company database
    const companyDatabase = {
      public: {
        technology: ['Rwanda Information Society Authority (RISA)', 'Rwanda ICT Chamber', 'Digital Ambassadors Program (DAP)'],
        finance: ['National Bank of Rwanda (BNR)', 'Rwanda Social Security Board (RSSB)', 'Rwanda Revenue Authority (RRA)'],
        telecommunications: ['Rwanda Utilities Regulatory Authority (RURA)'],
        government: ['Ministry of ICT and Innovation', 'Rwanda Development Board (RDB)', 'Rwanda Governance Board (RGB)', 'Public Service Commission'],
        healthcare: ['Rwanda Biomedical Center (RBC)', 'King Faisal Hospital', 'University Teaching Hospital of Kigali (CHUK)'],
        education: ['University of Rwanda', 'Rwanda Polytechnic', 'Rwanda Education Board (REB)'],
        energy: ['Rwanda Energy Group (REG)', 'Rwanda Mines, Petroleum and Gas Board']
      },
      private: {
        technology: ['Positivo BGH', 'AC Group', 'IREMBO', 'Mergims Technologies', 'Westerwelle Startup Haus', 'Norrsken House Kigali'],
        finance: ['Bank of Kigali (BK)', 'Equity Bank Rwanda', 'I&M Bank Rwanda', 'Access Bank Rwanda', 'Urwego Opportunity Bank'],
        telecommunications: ['MTN Rwanda', 'Airtel Rwanda', 'Liquid Telecom Rwanda'],
        manufacturing: ['Bralirwa Ltd', 'SULFO Rwanda Industries', 'Inyange Industries', 'SKol Brewery Ltd'],
        agriculture: ['Rwanda Agriculture Board', 'NAEB'],
        tourism: ['Akagera Aviation', 'Rwanda Tours', 'Kigali Serena Hotel', 'Marriott Hotel Kigali'],
        healthcare: ['King Faisal Hospital', 'Clinique La Medicale']
      }
    };

    // Rwanda administrative data
    const districtsByProvince = {
      'Kigali': ['Gasabo','Kicukiro','Nyarugenge'],
      'Northern': ['Burera','Gakenke','Gicumbi','Musanze','Rulindo'],
      'Southern': ['Gisagara','Huye','Kamonyi','Muhanga','Nyanza','Nyaruguru','Ruhango'],
      'Eastern': ['Bugesera','Gatsibo','Kayonza','Kirehe','Ngoma','Nyagatare','Rwamagana'],
      'Western': ['Karongi','Ngororero','Nyabihu','Nyamasheke','Rubavu','Rusizi','Rutsiro']
    };

    const sectorsByDistrict = {
      'Gasabo': ['Bumbogo','Gatsata','Gikomero','Gisozi','Jabana','Jali','Kacyiru','Kimihurura','Kimironko','Kinyinya','Ndera','Nduba','Remera','Rusororo','Rutunga'],
      'Kicukiro': ['Gahanga','Gatenga','Gikondo','Kagarama','Kanombe','Kicukiro','Kigarama','Masaka','Niboye','Nyarugunga'],
      'Nyarugenge': ['Gitega','Kanyinya','Kigali','Kimisagara','Mageragere','Muhima','Nyakabanda','Nyamirambo','Nyarugenge','Rwezamenyo']
    };

    // Initialize storage
    async function initializeStorage() {
      try {
        const capsResult = await window.storage.get('department-capacities', true);
        if (capsResult && capsResult.value) {
          departmentCapacities = JSON.parse(capsResult.value);
        }
        
        const appsResult = await window.storage.get('department-applications', true);
        if (appsResult && appsResult.value) {
          departmentApplications = JSON.parse(appsResult.value);
        }

        const submittedResult = await window.storage.get('all-applicants', true);
        if (submittedResult && submittedResult.value) {
          submittedApplications = JSON.parse(submittedResult.value);
        }
      } catch (error) {
        console.log('Initializing storage');
      }
    }

    async function saveAdminData() {
      try {
        await window.storage.set('department-capacities', JSON.stringify(departmentCapacities), true);
        await window.storage.set('department-applications', JSON.stringify(departmentApplications), true);
        await window.storage.set('all-applicants', JSON.stringify(submittedApplications), true);
      } catch (error) {
        console.error('Error saving data:', error);
      }
    }

    // Page navigation
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      
      if (pageId === 'adminDashboard') {
        renderAdminDashboard();
      }
    }

    // Applicant auth toggle
    function toggleApplicantMode() {
      isApplicantSignup = !isApplicantSignup;
      const title = document.getElementById('applicantAuthTitle');
      const toggleText = document.getElementById('applicantToggleText');
      const fieldContainer = document.getElementById('applicantFieldContainer');
      const submitBtn = document.querySelector('#applicantAuthForm button[type="submit"]');
      
      if (isApplicantSignup) {
        title.textContent = 'Applicant Sign Up';
        toggleText.innerHTML = 'Already have an account? <a onclick="toggleApplicantMode()">Login</a>';
        fieldContainer.style.display = 'block';
        submitBtn.textContent = 'Sign Up';
      } else {
        title.textContent = 'Applicant Login';
        toggleText.innerHTML = 'Don\'t have an account? <a onclick="toggleApplicantMode()">Sign Up</a>';
        fieldContainer.style.display = 'none';
        submitBtn.textContent = 'Login';
      }
    }

    // Company auth toggle
    function toggleCompanyMode() {
      isCompanySignup = !isCompanySignup;
      const title = document.getElementById('companyAuthTitle');
      const toggleText = document.getElementById('companyToggleText');
      const submitBtn = document.querySelector('#companyAuthForm button[type="submit"]');
      
      if (isCompanySignup) {
        title.textContent = 'Company Sign Up';
        toggleText.innerHTML = 'Already have an account? <a onclick="toggleCompanyMode()">Login</a>';
        submitBtn.textContent = 'Sign Up';
      } else {
        title.textContent = 'Company Login';
        toggleText.innerHTML = 'Don\'t have an account? <a onclick="toggleCompanyMode()">Sign Up</a>';
        submitBtn.textContent = 'Login';
      }
    }

    // Handle applicant auth
    function handleApplicantAuth(e) {
      e.preventDefault();
      const name = document.getElementById('applicantName').value;
      const email = document.getElementById('applicantEmail').value;
      const password = document.getElementById('applicantPassword').value;
      const field = document.getElementById('applicantField').value;

      if (isApplicantSignup) {
        if (!field) {
          alert('‚ö†Ô∏è Please enter your field of study');
          return;
        }
        const exists = applicantsDB.find(a => a.email === email);
        if (exists) {
          alert('‚ùå An account with this email already exists!');
          return;
        }
        applicantsDB.push({ name, email, password, field });
        alert('‚úÖ Account created successfully! Please login.');
        toggleApplicantMode();
        e.target.reset();
      } else {
        const user = applicantsDB.find(a => a.email === email && a.password === password);
        if (user) {
          currentUser = user;
          currentUserType = 'applicant';
          document.getElementById('applicantNameDisplay').textContent = user.name;
          showPage('applicantDashboard');
          setMinMaxDates();
        } else {
          alert('‚ùå Invalid email or password!');
        }
      }
    }

    // Handle company auth
    function handleCompanyAuth(e) {
      e.preventDefault();
      const name = document.getElementById('companyName').value;
      const email = document.getElementById('companyEmail').value;
      const password = document.getElementById('companyPassword').value;

      if (isCompanySignup) {
        const exists = companiesDB.find(c => c.email === email);
        if (exists) {
          alert('‚ùå An account with this email already exists!');
          return;
        }
        companiesDB.push({ name, email, password });
        alert('‚úÖ Company account created! Please login.');
        toggleCompanyMode();
        e.target.reset();
      } else {
        const company = companiesDB.find(c => c.email === email && c.password === password);
        if (company) {
          currentUser = company;
          currentUserType = 'company';
          document.getElementById('companyNameDisplay').textContent = company.name;
          showPage('companyDashboard');
          showCompanyInternships();
        } else {
          alert('‚ùå Invalid email or password!');
        }
      }
    }

    // Admin password check
    function checkAdminPassword() {
      const pass = prompt("üîí Enter admin password:");
      if (pass === "sha10ro*") {
        currentUserType = 'admin';
        initializeStorage().then(() => {
          showPage('adminDashboard');
        });
      } else if (pass !== null) {
        alert("‚ùå Incorrect password!");
      }
    }

    // Set min/max dates
    function setMinMaxDates() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('startDate').setAttribute('min', today);
      
      const eighteenYearsAgo = new Date();
      eighteenYearsAgo.setFullYear(eighteenYearsAgo.getFullYear() - 18);
      document.getElementById('dob').setAttribute('max', eighteenYearsAgo.toISOString().split('T')[0]);
    }

    // Filter companies
    function filterCompanies() {
      const type = document.getElementById('companyType').value;
      const industry = document.getElementById('industry').value;
      const companySelect = document.getElementById('company');
      
      companySelect.innerHTML = '<option value="">Select Company...</option>';
      
      if (!type || !industry || industry === 'all') return;
      
      let companyList = [];
      
      if (type === 'all') {
        if (companyDatabase.public[industry]) companyList = companyList.concat(companyDatabase.public[industry]);
        if (companyDatabase.private[industry]) companyList = companyList.concat(companyDatabase.private[industry]);
      } else if (type === 'public' && companyDatabase.public[industry]) {
        companyList = companyDatabase.public[industry];
      } else if (type === 'private' && companyDatabase.private[industry]) {
        companyList = companyDatabase.private[industry];
      }
      
      companyList.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        companySelect.appendChild(opt);
      });
      
      updateFilledCount();
    }

    // Populate districts
    function populateDistricts() {
      const prov = document.getElementById('province').value;
      const districtSelect = document.getElementById('district');
      const sectorSelect = document.getElementById('sector');
      
      districtSelect.innerHTML = '<option value="">Select District...</option>';
      sectorSelect.innerHTML = '<option value="">First select district...</option>';
      
      if (!prov) return;
      
      const districts = districtsByProvince[prov] || [];
      districts.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = d;
        districtSelect.appendChild(opt);
      });
      
      updateFilledCount();
    }

    // Populate sectors
    function populateSectors() {
      const dist = document.getElementById('district').value;
      const sectorSelect = document.getElementById('sector');
      
      sectorSelect.innerHTML = '<option value="">Select Sector...</option>';
      
      if (!dist) return;
      
      const sectors = sectorsByDistrict[dist] || ['Sector 1', 'Sector 2', 'Sector 3'];
      sectors.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s;
        opt.textContent = s;
        sectorSelect.appendChild(opt);
      });
      
      updateFilledCount();
    }

    // Preview image
    function previewImage(e, id) {
      const file = e.target.files && e.target.files[0];
      const img = document.getElementById(id);
      
      if (!file) {
        img.src = '';
        img.style.display = 'none';
        return;
      }
      
      if (file.type.includes('image')) {
        const reader = new FileReader();
        reader.onload = function(ev) {
          img.src = ev.target.result;
          img.style.display = 'block';
        }
        reader.readAsDataURL(file);
      }
    }

    // Update filled count
    const requiredSelectors = [
      '#companyType', '#industry', '#company', '#department', '#duration', '#startDate',
      '#fullname', '#gender', '#dob', '#email', '#phone', '#nationalId',
      '#institution', '#studyLevel', '#fieldOfStudy', '#yearOfStudy', '#graduationDate',
      '#province', '#district', '#sector',
      '#idfile', '#photofile', '#cvfile', '#reportfile', '#coverLetter', '#motivation'
    ];

    function updateFilledCount() {
      let count = 0;
      requiredSelectors.forEach(sel => {
        const el = document.querySelector(sel);
        if (!el) return;
        
        if (el.type === 'file') {
          if (el.files && el.files.length > 0) count++;
        } else if (el.value && el.value.trim() !== '') {
          count++;
        }
      });
      
      const total = requiredSelectors.length;
      document.getElementById('filledCount').textContent = count + ' / ' + total;
    }

    // Reset application form
    function resetApplicationForm() {
      document.getElementById('idPreview').style.display = 'none';
      document.getElementById('photoPreview').style.display = 'none';
      document.getElementById('company').innerHTML = '<option value="">First select company type and industry...</option>';
      updateFilledCount();
    }

    // Handle internship submission
    async function handleInternshipSubmit(e) {
      e.preventDefault();
      
      const form = document.getElementById('internForm');
      const fd = new FormData(form);
      
      const application = {
        fullname: document.getElementById('fullname').value,
        department: document.getElementById('department').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        sector: document.getElementById('sector').value,
        district: document.getElementById('district').value,
        company: document.getElementById('company').value,
        status: 'pending',
        submittedAt: new Date().toISOString()
      };
      
      submittedApplications.push(application);
      
      const dept = application.department;
      if (!departmentApplications[dept]) {
        departmentApplications[dept] = 0;
      }
      departmentApplications[dept]++;
      
      await saveAdminData();
      
      const companyName = document.getElementById('company').value;
      alert('‚úÖ Application submitted successfully!\n\nYour internship application to ' + companyName + ' has been received.\n\nYou will receive a confirmation email shortly.');
      
      form.reset();
      resetApplicationForm();
    }

    // Company internship management
    function handleCompanyInternship(e) {
      e.preventDefault();
      const field = document.getElementById('compField').value;
      const slots = parseInt(document.getElementById('compSlots').value);
      
      if (!field || !slots) {
        alert('‚ö†Ô∏è Please fill all fields');
        return;
      }
      
      companyInternships.push({
        company: currentUser.name,
        field,
        slots,
        postedBy: currentUser.email
      });
      
      alert('üè¢ Internship position added successfully!');
      showCompanyInternships();
      e.target.reset();
    }

    function showCompanyInternships() {
      const list = document.getElementById('companyInternships');
      list.innerHTML = '';
      
      const companyPosts = companyInternships.filter(c => c.postedBy === currentUser.email);
      
      if (companyPosts.length === 0) {
        list.innerHTML = '<p style="color: #e0f0ff;">You haven\'t posted any internships yet.</p>';
        return;
      }

      companyPosts.forEach(c => {
        const div = document.createElement('div');
        div.className = 'stat-card';
        div.innerHTML = `
          <strong style="color: #4dd0ff;">${c.field}</strong>
          <div style="margin: 10px 0; color: #e0f0ff;">
            <div>üíº Slots available: ${c.slots}</div>
          </div>
        `;
        list.appendChild(div);
      });
    }

    // Admin Dashboard Functions
    function switchAdminTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tabName).classList.add('active');
      
      renderAdminDashboard();
    }

    function renderAdminDashboard() {
      renderStats();
      renderOverview();
      renderCapacityGrid();
      renderApplicantsTable();
      populateDeptFilter();
    }

    function renderStats() {
      const totalApps = submittedApplications.length;
      const totalCap = Object.values(departmentCapacities).reduce((a, b) => a + b, 0);
      const available = totalCap - totalApps;

      document.getElementById('totalApps').textContent = totalApps;
      document.getElementById('totalCapacity').textContent = totalCap;
      document.getElementById('availableSpaces').textContent = Math.max(0, available);
    }

    function renderOverview() {
      const grid = document.getElementById('overviewGrid');
      let html = '<div class="capacity-grid">';
      
      departments.forEach(dept => {
        const capacity = departmentCapacities[dept] || 0;
        const applications = departmentApplications[dept] || 0;
        const remaining = Math.max(0, capacity - applications);
        const statusClass = remaining > 0 ? 'remaining' : 'full';
        
        html += `
          <div class="capacity-item">
            <div class="dept-name">${dept}</div>
            <div class="stat-mini">
              <div class="stat-mini-label">Capacity</div>
              <div class="stat-mini-value">${capacity}</div>
            </div>
            <div class="stat-mini">
              <div class="stat-mini-label">Applications</div>
              <div class="stat-mini-value">${applications}</div>
            </div>
            <div class="stat-mini">
              <div class="stat-mini-label">Remaining</div>
              <div class="stat-mini-value ${statusClass}">${remaining}</div>
            </div>
            <div></div>
          </div>
        `;
      });
      
      html += '</div>';
      grid.innerHTML = html;
    }

    function renderCapacityGrid() {
      const grid = document.getElementById('capacityGrid');
      let html = '';
      
      departments.forEach(dept => {
        const capacity = departmentCapacities[dept] || 0;
        const applications = departmentApplications[dept] || 0;
        const remaining = Math.max(0, capacity - applications);
        const escapedDept = dept.replace(/\s+/g, '-').replace(/&/g, 'and');
        
        html += `
          <div class="capacity-item">
            <div class="dept-name">${dept}</div>
            <div class="stat-mini">
              <div class="stat-mini-label">Applications</div>
              <div class="stat-mini-value">${applications}</div>
            </div>
            <div class="stat-mini">
              <div class="stat-mini-label">Remaining</div>
              <div class="stat-mini-value ${remaining > 0 ? 'remaining' : 'full'}">${remaining}</div>
            </div>
            <div>
              <input type="number" id="cap-${escapedDept}" value="${capacity}" min="0" placeholder="Set capacity">
            </div>
            <div>
              <button class="btn-3d btn-3d-success btn-small" onclick="updateCapacity('${dept.replace(/'/g, "\\'")}', '${escapedDept}')">Update</button>
            </div>
          </div>
        `;
      });
      
      grid.innerHTML = html;
    }

    async function updateCapacity(department, escapedDept) {
      const input = document.getElementById(`cap-${escapedDept}`);
      const newCapacity = parseInt(input.value) || 0;
      
      departmentCapacities[department] = newCapacity;
      await saveAdminData();
      renderAdminDashboard();
      
      alert(`‚úÖ Capacity for ${department} updated to ${newCapacity}`);
    }

    function populateDeptFilter() {
      const filter = document.getElementById('deptFilter');
      filter.innerHTML = '<option value="">All Departments</option>';
      
      departments.forEach(dept => {
        filter.innerHTML += `<option value="${dept}">${dept}</option>`;
      });
    }

    function renderApplicantsTable() {
      const tbody = document.getElementById('applicantsTableBody');
      
      if (submittedApplications.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8">
              <div class="empty-state">
                <div class="empty-state-icon">üìã</div>
                <div>No applicants yet</div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      let html = '';
      submittedApplications.forEach((app, index) => {
        const statusClass = app.status === 'approved' ? 'success' : app.status === 'rejected' ? 'danger' : 'warning';
        
        html += `
          <tr>
            <td>${index + 1}</td>
            <td>${app.fullname}</td>
            <td>${app.department}</td>
            <td>${app.email}</td>
            <td>${app.phone}</td>
            <td>${app.sector}, ${app.district}</td>
            <td><span class="badge badge-${statusClass}">${app.status || 'pending'}</span></td>
            <td>
              <div class="action-buttons">
                ${app.status !== 'approved' ? `<button class="btn-3d btn-3d-success btn-small" onclick="updateStatus(${index}, 'approved')">Approve</button>` : ''}
                ${app.status !== 'rejected' ? `<button class="btn-3d btn-3d-danger btn-small" onclick="updateStatus(${index}, 'rejected')">Reject</button>` : ''}
              </div>
            </td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
    }

    async function updateStatus(index, status) {
      submittedApplications[index].status = status;
      await saveAdminData();
      renderApplicantsTable();
      alert(`‚úÖ Application ${status}!`);
    }

    function filterApplicants() {
      const deptFilter = document.getElementById('deptFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;
      const searchText = document.getElementById('searchBox').value.toLowerCase();

      const tbody = document.getElementById('applicantsTableBody');
      
      const filtered = submittedApplications.filter(app => {
        const matchesDept = !deptFilter || app.department === deptFilter;
        const matchesStatus = !statusFilter || (app.status || 'pending') === statusFilter;
        const matchesSearch = !searchText || 
          app.fullname.toLowerCase().includes(searchText) ||
          app.email.toLowerCase().includes(searchText) ||
          app.phone.toLowerCase().includes(searchText);
        
        return matchesDept && matchesStatus && matchesSearch;
      });

      if (filtered.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8">
              <div class="empty-state">
                <div class="empty-state-icon">üîç</div>
                <div>No applicants match your filters</div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      let html = '';
      filtered.forEach((app, index) => {
        const actualIndex = submittedApplications.indexOf(app);
        const statusClass = app.status === 'approved' ? 'success' : app.status === 'rejected' ? 'danger' : 'warning';
        
        html += `
          <tr>
            <td>${index + 1}</td>
            <td>${app.fullname}</td>
            <td>${app.department}</td>
            <td>${app.email}</td>
            <td>${app.phone}</td>
            <td>${app.sector}, ${app.district}</td>
            <td><span class="badge badge-${statusClass}">${app.status || 'pending'}</span></td>
            <td>
              <div class="action-buttons">
                ${app.status !== 'approved' ? `<button class="btn-3d btn-3d-success btn-small" onclick="updateStatus(${actualIndex}, 'approved')">Approve</button>` : ''}
                ${app.status !== 'rejected' ? `<button class="btn-3d btn-3d-danger btn-small" onclick="updateStatus(${actualIndex}, 'rejected')">Reject</button>` : ''}
              </div>
            </td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
    }

    function logout() {
      currentUser = null;
      currentUserType = null;
      document.querySelectorAll('form').forEach(f => f.reset());
      showPage('landingPage');
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('idPreview').style.display = 'none';
      document.getElementById('photoPreview').style.display = 'none';
      updateFilledCount();
      
      // Add event listeners for form tracking
      document.addEventListener('change', updateFilledCount);
      document.addEventListener('input', updateFilledCount);
    });
  </script>
</body>
</html>s